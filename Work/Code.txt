import pandas as pd
from transformers import pipeline
from collections import defaultdict

# Read the sample CSV file
file_path = 'sample_chat_data.csv'
df = pd.read_csv(file_path)

# Initialize a dictionary to hold conversations
conversations = defaultdict(list)

# Group messages by conversationid
for _, row in df.iterrows():
    conversation_id = row['conversationid']
    sender = row['sender']
    message = f"{sender.capitalize()}: {row['message']}"
    conversations[conversation_id].append(message)

# Load the summarization pipeline
summarizer = pipeline("summarization")

# Summarize each conversation
conversation_summaries = {}
for cid, messages in conversations.items():
    conversation_text = ' '.join(messages)
    # Avoid duplicate messages in abandoned chats
    conversation_text = ' '.join(dict.fromkeys(conversation_text.split()))
    summary = summarizer(conversation_text, max_length=50, min_length=25, do_sample=False)[0]['summary_text']
    conversation_summaries[cid] = summary

# Display the first few summaries
for cid, summary in conversation_summaries.items():
    print(f"Conversation ID: {cid}")
    print(f"Summary: {summary}\n")
